<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>VastraVerse: SmartWeave XR</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=Rajdhani:wght@300;400;600&display=swap');

  :root {
    --gold: #c9a84c;
    --gold-light: #e8c97a;
    --deep: #0a0608;
    --wine: #1a0810;
    --silk: #f5e6d0;
    --cyan: #00e5ff;
    --magenta: #ff2d78;
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    background: var(--deep);
    color: var(--silk);
    font-family: 'Rajdhani', sans-serif;
    overflow: hidden;
    height: 100vh;
    width: 100vw;
  }

  /* ‚îÄ‚îÄ CANVAS ‚îÄ‚îÄ */
  #xr-canvas {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
  }

  /* ‚îÄ‚îÄ OVERLAY UI ‚îÄ‚îÄ */
  #ui {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 10;
  }

  /* ‚îÄ‚îÄ TITLE BAR ‚îÄ‚îÄ */
  .title-bar {
    position: absolute;
    top: 0; left: 0; right: 0;
    padding: 18px 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: linear-gradient(180deg, rgba(10,6,8,0.95) 0%, transparent 100%);
    border-bottom: 1px solid rgba(201,168,76,0.2);
  }

  .brand {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.5rem;
    font-weight: 300;
    letter-spacing: 0.3em;
    color: var(--gold-light);
    text-transform: uppercase;
  }
  .brand span { color: var(--magenta); }

  .mode-badge {
    font-size: 0.7rem;
    letter-spacing: 0.25em;
    padding: 4px 14px;
    border: 1px solid var(--gold);
    color: var(--gold);
    text-transform: uppercase;
    border-radius: 2px;
    background: rgba(201,168,76,0.08);
  }

  /* ‚îÄ‚îÄ LEFT PANEL ‚îÄ‚îÄ */
  .panel-left {
    position: absolute;
    top: 80px;
    left: 24px;
    width: 260px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    pointer-events: all;
  }

  .card {
    background: rgba(10,6,8,0.85);
    border: 1px solid rgba(201,168,76,0.25);
    border-left: 2px solid var(--gold);
    padding: 14px 16px;
    backdrop-filter: blur(12px);
    border-radius: 2px;
  }

  .card-title {
    font-size: 0.65rem;
    letter-spacing: 0.25em;
    color: var(--gold);
    text-transform: uppercase;
    margin-bottom: 10px;
    font-weight: 600;
  }

  /* ‚îÄ‚îÄ TEMP SENSOR ‚îÄ‚îÄ */
  .temp-display {
    display: flex;
    align-items: baseline;
    gap: 6px;
    margin-bottom: 8px;
  }
  .temp-val {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2.4rem;
    font-weight: 300;
    color: var(--silk);
    line-height: 1;
  }
  .temp-unit { font-size: 0.9rem; color: var(--gold); }

  .temp-slider {
    -webkit-appearance: none;
    width: 100%;
    height: 3px;
    background: linear-gradient(90deg, var(--cyan) 0%, var(--magenta) 100%);
    border-radius: 2px;
    outline: none;
    margin-bottom: 10px;
  }
  .temp-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 14px; height: 14px;
    border-radius: 50%;
    background: white;
    border: 2px solid var(--gold);
    cursor: pointer;
    box-shadow: 0 0 8px var(--gold);
  }

  .status-box {
    font-size: 0.75rem;
    letter-spacing: 0.08em;
    color: var(--cyan);
    font-family: 'Courier New', monospace;
    line-height: 1.7;
    padding: 8px;
    background: rgba(0,229,255,0.05);
    border: 1px solid rgba(0,229,255,0.15);
  }

  /* ‚îÄ‚îÄ FABRIC SELECTOR ‚îÄ‚îÄ */
  .fabric-list {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .fabric-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 10px;
    border: 1px solid rgba(201,168,76,0.15);
    cursor: pointer;
    transition: all 0.2s;
    border-radius: 1px;
  }
  .fabric-item:hover, .fabric-item.active {
    border-color: var(--gold);
    background: rgba(201,168,76,0.08);
  }
  .fabric-swatch {
    width: 28px; height: 28px;
    border-radius: 50%;
    border: 2px solid rgba(255,255,255,0.1);
    flex-shrink: 0;
  }
  .fabric-name {
    font-size: 0.8rem;
    font-weight: 600;
    letter-spacing: 0.05em;
  }
  .fabric-sub {
    font-size: 0.65rem;
    color: rgba(245,230,208,0.5);
    letter-spacing: 0.05em;
  }

  /* ‚îÄ‚îÄ RIGHT PANEL ‚îÄ‚îÄ */
  .panel-right {
    position: absolute;
    top: 80px;
    right: 24px;
    width: 220px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    pointer-events: all;
  }

  .stat-card {
    background: rgba(10,6,8,0.85);
    border: 1px solid rgba(201,168,76,0.2);
    border-right: 2px solid var(--gold);
    padding: 12px 14px;
    backdrop-filter: blur(12px);
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .stat-icon { font-size: 1.2rem; }
  .stat-label {
    font-size: 0.6rem;
    letter-spacing: 0.2em;
    color: var(--gold);
    text-transform: uppercase;
  }
  .stat-value {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--silk);
    margin-top: 2px;
  }

  /* ‚îÄ‚îÄ XR BUTTONS ‚îÄ‚îÄ */
  .xr-controls {
    position: absolute;
    bottom: 40px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 16px;
    pointer-events: all;
  }

  .xr-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    padding: 16px 28px;
    background: rgba(10,6,8,0.9);
    border: 1px solid var(--gold);
    color: var(--gold-light);
    font-family: 'Rajdhani', sans-serif;
    font-size: 0.8rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.3s;
    backdrop-filter: blur(12px);
    border-radius: 2px;
    font-weight: 600;
    position: relative;
    overflow: hidden;
  }
  .xr-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, transparent 40%, rgba(201,168,76,0.1));
    opacity: 0;
    transition: opacity 0.3s;
  }
  .xr-btn:hover::before { opacity: 1; }
  .xr-btn:hover {
    border-color: var(--gold-light);
    box-shadow: 0 0 24px rgba(201,168,76,0.3), inset 0 0 24px rgba(201,168,76,0.05);
    transform: translateY(-2px);
  }
  .xr-btn .icon { font-size: 1.5rem; }

  .xr-btn.ar-btn { border-color: var(--cyan); color: var(--cyan); }
  .xr-btn.ar-btn:hover { box-shadow: 0 0 24px rgba(0,229,255,0.3); border-color: var(--cyan); }

  .xr-btn.vr-btn { border-color: var(--magenta); color: var(--magenta); }
  .xr-btn.vr-btn:hover { box-shadow: 0 0 24px rgba(255,45,120,0.3); }

  /* ‚îÄ‚îÄ NOTIFICATION ‚îÄ‚îÄ */
  #notif {
    position: fixed;
    top: 80px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(10,6,8,0.95);
    border: 1px solid var(--gold);
    color: var(--gold-light);
    padding: 12px 28px;
    font-size: 0.8rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    border-radius: 2px;
    z-index: 100;
    display: none;
    backdrop-filter: blur(16px);
    box-shadow: 0 0 40px rgba(201,168,76,0.2);
    text-align: center;
    max-width: 420px;
    pointer-events: none;
  }

  /* ‚îÄ‚îÄ AR MODE OVERLAY ‚îÄ‚îÄ */
  #ar-overlay {
    position: fixed;
    inset: 0;
    z-index: 50;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: flex-end;
    padding-bottom: 80px;
    background: transparent;
    pointer-events: none;
  }

  .ar-scan-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 200px;
    height: 80px;
    border: 2px solid var(--cyan);
    border-radius: 50%;
    box-shadow: 0 0 30px rgba(0,229,255,0.4);
    animation: scanPulse 2s ease-in-out infinite;
  }
  .ar-scan-ring::before {
    content: '';
    position: absolute;
    inset: -8px;
    border: 1px solid rgba(0,229,255,0.3);
    border-radius: 50%;
  }
  @keyframes scanPulse {
    0%, 100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    50% { opacity: 0.5; transform: translate(-50%, -50%) scale(1.05); }
  }

  .ar-hint {
    background: rgba(0,0,0,0.7);
    border: 1px solid var(--cyan);
    color: var(--cyan);
    padding: 10px 24px;
    font-size: 0.75rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    border-radius: 2px;
    backdrop-filter: blur(12px);
    pointer-events: all;
    cursor: pointer;
  }

  /* ‚îÄ‚îÄ VR SCENE DEMO ‚îÄ‚îÄ */
  #vr-demo {
    position: fixed;
    inset: 0;
    z-index: 40;
    display: none;
    background: #050203;
  }
  #vr-canvas { width: 100%; height: 100%; display: block; }
  .vr-exit {
    position: absolute;
    top: 20px;
    right: 24px;
    background: rgba(10,6,8,0.9);
    border: 1px solid var(--magenta);
    color: var(--magenta);
    padding: 8px 20px;
    font-family: 'Rajdhani', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    cursor: pointer;
    z-index: 10;
    pointer-events: all;
    transition: all 0.2s;
  }
  .vr-exit:hover { background: rgba(255,45,120,0.1); box-shadow: 0 0 20px rgba(255,45,120,0.3); }

  /* ‚îÄ‚îÄ PARTICLES ‚îÄ‚îÄ */
  #particles {
    position: fixed;
    inset: 0;
    z-index: 1;
    pointer-events: none;
  }

  /* ‚îÄ‚îÄ SHIMMER ‚îÄ‚îÄ */
  @keyframes shimmer {
    0% { background-position: -200% center; }
    100% { background-position: 200% center; }
  }
  .shimmer {
    background: linear-gradient(90deg, transparent, rgba(201,168,76,0.3), transparent);
    background-size: 200% auto;
    animation: shimmer 3s linear infinite;
  }
</style>
</head>
<body>

<canvas id="xr-canvas"></canvas>
<canvas id="particles"></canvas>

<!-- NOTIFICATION -->
<div id="notif"></div>

<!-- AR OVERLAY -->
<div id="ar-overlay">
  <div class="ar-scan-ring"></div>
  <div class="ar-hint" onclick="placeOnSurface()">‚ú¶ TAP TO PLACE FABRIC ON SURFACE</div>
</div>

<!-- VR DEMO SCENE -->
<div id="vr-demo">
  <canvas id="vr-canvas"></canvas>
  <button class="vr-exit" onclick="exitVR()">‚úï EXIT SHOWROOM</button>
</div>

<!-- MAIN UI -->
<div id="ui">
  <!-- TITLE -->
  <div class="title-bar">
    <div class="brand">Vastra<span>verse</span> ¬∑ SmartWeave</div>
    <div class="mode-badge" id="mode-badge">BROWSE MODE</div>
  </div>

  <!-- LEFT PANEL -->
  <div class="panel-left">
    <!-- SENSOR -->
    <div class="card">
      <div class="card-title">‚¨° Ambient Sensor</div>
      <div class="temp-display">
        <div class="temp-val" id="temp-display">44</div>
        <div class="temp-unit">¬∞C</div>
      </div>
      <input type="range" class="temp-slider" id="temp-slider" min="0" max="60" value="44"/>
      <div class="status-box" id="status-box">
        STATUS: COOLING ACTIVE<br/>
        FIBER: VENTILATING<br/>
        RESPONSE: OPTIMAL
      </div>
    </div>

    <!-- FABRIC -->
    <div class="card">
      <div class="card-title">‚óà Fabric Collection</div>
      <div class="fabric-list" id="fabric-list">
        <div class="fabric-item active" data-fabric="0" onclick="selectFabric(this,0)">
          <div class="fabric-swatch" style="background:radial-gradient(circle,#d4956a,#8b3a62)"></div>
          <div><div class="fabric-name">Kanchipuram Silk</div><div class="fabric-sub">NANO-THERMAL ¬∑ ECO</div></div>
        </div>
        <div class="fabric-item" data-fabric="1" onclick="selectFabric(this,1)">
          <div class="fabric-swatch" style="background:radial-gradient(circle,#4fc3f7,#1a237e)"></div>
          <div><div class="fabric-name">Cool Banarasi</div><div class="fabric-sub">GRAPHENE GRID</div></div>
        </div>
        <div class="fabric-item" data-fabric="2" onclick="selectFabric(this,2)">
          <div class="fabric-swatch" style="background:radial-gradient(circle,#a5d6a7,#2e7d32)"></div>
          <div><div class="fabric-name">Organic Khadi</div><div class="fabric-sub">MOISTURE-WICK</div></div>
        </div>
        <div class="fabric-item" data-fabric="3" onclick="selectFabric(this,3)">
          <div class="fabric-swatch" style="background:radial-gradient(circle,#ce93d8,#4a148c)"></div>
          <div><div class="fabric-name">Smart Chanderi</div><div class="fabric-sub">PHASE-CHANGE</div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- RIGHT PANEL -->
  <div class="panel-right">
    <div class="stat-card">
      <div class="stat-icon">‚ùÑÔ∏è</div>
      <div>
        <div class="stat-label">Cooling Threshold</div>
        <div class="stat-value" id="cool-thresh">&gt; 30¬∞C Active</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üî•</div>
      <div>
        <div class="stat-label">Heating Threshold</div>
        <div class="stat-value" id="heat-thresh">&lt; 20¬∞C Active</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üåø</div>
      <div>
        <div class="stat-label">Eco Material</div>
        <div class="stat-value" id="eco-mat">Organic Silk</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">‚ö°</div>
      <div>
        <div class="stat-label">Smart Response</div>
        <div class="stat-value" id="response-stat">98% Optimal</div>
      </div>
    </div>
    <div class="card shimmer" style="padding:10px 14px;">
      <div class="card-title">‚ñ∏ Fiber Analysis</div>
      <div id="fiber-list" style="font-size:0.75rem;line-height:2;color:rgba(245,230,208,0.8);">
        ‚Ä¢ Cooling Nano-Polymer<br/>
        ‚Ä¢ Graphene Thermal Grid<br/>
        ‚Ä¢ Moisture-wicking Core
      </div>
    </div>
  </div>

  <!-- XR CONTROLS -->
  <div class="xr-controls">
    <button class="xr-btn ar-btn" onclick="enterAR()">
      <span class="icon">üì±</span>
      Enter AR
      <span style="font-size:0.6rem;opacity:0.7">Surface Detection</span>
    </button>
    <button class="xr-btn" onclick="toggleRotate()">
      <span class="icon">üîÑ</span>
      Rotate View
      <span style="font-size:0.6rem;opacity:0.7">Interactive 3D</span>
    </button>
    <button class="xr-btn vr-btn" onclick="enterVR()">
      <span class="icon">ü•Ω</span>
      Enter VR
      <span style="font-size:0.6rem;opacity:0.7">Luxury Showroom</span>
    </button>
  </div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// MAIN 3D SCENE (Three.js-like via WebGL)
// Using raw canvas + requestAnimationFrame
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

const canvas = document.getElementById('xr-canvas');
const ctx = canvas.getContext('2d');

let W, H, cx, cy;
let angle = 0;
let autoRotate = true;
let selectedFabric = 0;
let currentTemp = 44;
let arMode = false;
let arPlaced = false;

const fabrics = [
  { name:'Kanchipuram Silk', eco:'Organic Silk', fibers:'‚Ä¢ Cooling Nano-Polymer\n‚Ä¢ Graphene Thermal Grid\n‚Ä¢ Moisture-wicking Core', colors:['#d4956a','#8b3a62','#f5d5b5'], hue:'warm' },
  { name:'Cool Banarasi', eco:'Recycled Polyester', fibers:'‚Ä¢ Graphene Neural Net\n‚Ä¢ Phase-Change Capsules\n‚Ä¢ Hydro-Gel Core', colors:['#4fc3f7','#1a237e','#b3e5fc'], hue:'cool' },
  { name:'Organic Khadi', eco:'Handspun Cotton', fibers:'‚Ä¢ Bio-Wick Fiber\n‚Ä¢ Natural Zeolite Layer\n‚Ä¢ Bamboo Charcoal Core', colors:['#a5d6a7','#2e7d32','#e8f5e9'], hue:'natural' },
  { name:'Smart Chanderi', eco:'Recycled Silk', fibers:'‚Ä¢ PCM Micro-Capsules\n‚Ä¢ Silver Ion Threads\n‚Ä¢ Aerogel Insulation', colors:['#ce93d8','#4a148c','#f3e5f5'], hue:'royal' }
];

function resize() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
  cx = W / 2; cy = H / 2;
}
resize();
window.addEventListener('resize', resize);

// ‚îÄ‚îÄ FLOOR GRID ‚îÄ‚îÄ
function drawFloor(t) {
  const f = fabrics[selectedFabric];
  const gridColor = f.hue === 'warm' ? '#1a0808' : f.hue === 'cool' ? '#080818' : f.hue === 'natural' ? '#081808' : '#100818';
  const lineColor = f.hue === 'warm' ? 'rgba(201,168,76,0.3)' : f.hue === 'cool' ? 'rgba(0,229,255,0.25)' : f.hue === 'natural' ? 'rgba(100,200,100,0.25)' : 'rgba(180,100,220,0.25)';

  // Background
  const bg = ctx.createRadialGradient(cx, cy, 0, cx, H*0.6, H);
  bg.addColorStop(0, gridColor);
  bg.addColorStop(1, '#050203');
  ctx.fillStyle = bg;
  ctx.fillRect(0, 0, W, H);

  // Horizon glow
  const glow = ctx.createLinearGradient(0, cy*0.6, 0, cy*1.1);
  const gc = f.hue === 'warm' ? 'rgba(201,80,40,0.12)' : f.hue === 'cool' ? 'rgba(0,100,255,0.12)' : f.hue === 'natural' ? 'rgba(0,180,80,0.1)' : 'rgba(150,0,200,0.12)';
  glow.addColorStop(0, gc);
  glow.addColorStop(1, 'transparent');
  ctx.fillStyle = glow;
  ctx.fillRect(0, cy*0.6, W, cy*0.5);

  // Perspective grid
  const vanishY = cy * 0.55;
  const gridLines = 20;
  const offset = (t * 30) % (H / gridLines);

  ctx.save();
  ctx.strokeStyle = lineColor;
  ctx.lineWidth = 0.5;

  // Horizontal lines
  for (let i = 0; i <= gridLines; i++) {
    const y = vanishY + offset + (i / gridLines) * (H - vanishY);
    if (y > H) continue;
    const progress = (y - vanishY) / (H - vanishY);
    const x0 = cx - progress * W * 0.85;
    const x1 = cx + progress * W * 0.85;
    ctx.globalAlpha = progress * 0.6;
    ctx.beginPath();
    ctx.moveTo(x0, y);
    ctx.lineTo(x1, y);
    ctx.stroke();
  }

  // Vertical lines
  const vLines = 14;
  for (let i = 0; i <= vLines; i++) {
    const t2 = i / vLines;
    const botX = cx - (0.5 - t2) * W * 1.7;
    ctx.globalAlpha = 0.4;
    ctx.beginPath();
    ctx.moveTo(cx + (t2 - 0.5) * 2, vanishY);
    ctx.lineTo(botX, H + 20);
    ctx.stroke();
  }
  ctx.restore();
}

// ‚îÄ‚îÄ FIGURE (stylized saree avatar) ‚îÄ‚îÄ
function drawFigure(t) {
  const f = fabrics[selectedFabric];
  const [c1, c2, c3] = f.colors;
  const figX = cx;
  const figY = cy * 0.55;
  const scale = Math.min(W, H) * 0.0014;
  const bob = Math.sin(t * 1.2) * 2;

  ctx.save();
  ctx.translate(figX, figY + bob);
  ctx.scale(scale, scale);

  // Saree drape glow
  const aura = ctx.createRadialGradient(0, 60, 20, 0, 60, 180);
  aura.addColorStop(0, c1 + '44');
  aura.addColorStop(1, 'transparent');
  ctx.fillStyle = aura;
  ctx.fillRect(-180, -80, 360, 360);

  // Body silhouette (stylized)
  ctx.shadowBlur = 30;
  ctx.shadowColor = c1;

  // Saree body
  const bodyGrad = ctx.createLinearGradient(-50, 0, 50, 280);
  bodyGrad.addColorStop(0, c1);
  bodyGrad.addColorStop(0.4, c2);
  bodyGrad.addColorStop(1, c2 + 'aa');
  ctx.fillStyle = bodyGrad;
  ctx.beginPath();
  ctx.ellipse(0, 140, 52, 140, 0, 0, Math.PI * 2);
  ctx.fill();

  // Pallu drape
  const palluGrad = ctx.createLinearGradient(-60, 0, 60, 200);
  palluGrad.addColorStop(0, c3 + 'cc');
  palluGrad.addColorStop(1, c1 + '88');
  ctx.fillStyle = palluGrad;
  ctx.beginPath();
  ctx.moveTo(-20, 40);
  ctx.quadraticCurveTo(-80, 120, -60, 260);
  ctx.quadraticCurveTo(-30, 280, 10, 270);
  ctx.quadraticCurveTo(-10, 200, 20, 40);
  ctx.closePath();
  ctx.fill();

  // Head
  ctx.shadowBlur = 10;
  ctx.fillStyle = '#c8a882';
  ctx.beginPath();
  ctx.ellipse(0, -80, 26, 32, 0, 0, Math.PI * 2);
  ctx.fill();

  // Hair bun
  ctx.fillStyle = '#1a0a05';
  ctx.beginPath();
  ctx.ellipse(0, -108, 16, 12, -0.3, 0, Math.PI * 2);
  ctx.fill();

  // Neck
  ctx.fillStyle = '#c8a882';
  ctx.fillRect(-8, -50, 16, 30);

  // Blouse
  const blouseGrad = ctx.createLinearGradient(-40, -20, 40, 40);
  blouseGrad.addColorStop(0, c2);
  blouseGrad.addColorStop(1, c2 + 'cc');
  ctx.fillStyle = blouseGrad;
  ctx.beginPath();
  ctx.roundRect(-38, -20, 76, 60, 4);
  ctx.fill();

  // Smart fiber glow lines
  ctx.globalAlpha = 0.5 + Math.sin(t * 3) * 0.2;
  ctx.strokeStyle = f.hue === 'cool' ? '#00e5ff' : f.hue === 'warm' ? '#ffd54f' : f.hue === 'natural' ? '#69f0ae' : '#ea80fc';
  ctx.lineWidth = 1;
  ctx.shadowBlur = 8;
  ctx.shadowColor = ctx.strokeStyle;
  for (let i = 0; i < 5; i++) {
    const lx = -30 + i * 14;
    ctx.beginPath();
    ctx.moveTo(lx, 10);
    ctx.lineTo(lx - 5, 260);
    ctx.stroke();
  }

  ctx.restore();
}

// ‚îÄ‚îÄ AMBIENT PARTICLES ‚îÄ‚îÄ
const pCanvas = document.getElementById('particles');
const pCtx = pCanvas.getContext('2d');
let particles = [];

function initParticles() {
  pCanvas.width = W; pCanvas.height = H;
  particles = Array.from({length: 60}, () => ({
    x: Math.random() * W,
    y: Math.random() * H,
    r: Math.random() * 1.5 + 0.3,
    vx: (Math.random() - 0.5) * 0.3,
    vy: -Math.random() * 0.4 - 0.1,
    alpha: Math.random() * 0.4 + 0.1
  }));
}
initParticles();
window.addEventListener('resize', initParticles);

function drawParticles(t) {
  pCanvas.width = W; pCanvas.height = H;
  const f = fabrics[selectedFabric];
  const pc = f.hue === 'cool' ? '#00e5ff' : f.hue === 'warm' ? '#ffd54f' : f.hue === 'natural' ? '#69f0ae' : '#ea80fc';
  particles.forEach(p => {
    p.x += p.vx;
    p.y += p.vy;
    if (p.y < 0) p.y = H;
    if (p.x < 0) p.x = W;
    if (p.x > W) p.x = 0;
    pCtx.beginPath();
    pCtx.arc(p.x, p.y, p.r, 0, Math.PI*2);
    pCtx.fillStyle = pc;
    pCtx.globalAlpha = p.alpha * (0.5 + Math.sin(t * 2 + p.x) * 0.3);
    pCtx.fill();
  });
}

// ‚îÄ‚îÄ MAIN LOOP ‚îÄ‚îÄ
let lastT = 0;
function loop(ts) {
  const t = ts / 1000;
  if (autoRotate) angle += 0.003;

  ctx.clearRect(0, 0, W, H);
  drawFloor(t);
  drawFigure(t);
  drawParticles(t);

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

// ‚îÄ‚îÄ TEMP CONTROLLER ‚îÄ‚îÄ
const slider = document.getElementById('temp-slider');
const tempDisplay = document.getElementById('temp-display');
const statusBox = document.getElementById('status-box');
const coolThresh = document.getElementById('cool-thresh');
const heatThresh = document.getElementById('heat-thresh');

slider.addEventListener('input', () => {
  currentTemp = parseInt(slider.value);
  tempDisplay.textContent = currentTemp;
  updateStatus();
});

function updateStatus() {
  if (currentTemp > 30) {
    statusBox.innerHTML = 'STATUS: COOLING ACTIVE<br/>FIBER: VENTILATING<br/>RESPONSE: OPTIMAL';
    statusBox.style.color = '#00e5ff';
    coolThresh.textContent = '> 30¬∞C Active';
    heatThresh.textContent = '< 20¬∞C Standby';
  } else if (currentTemp < 20) {
    statusBox.innerHTML = 'STATUS: HEATING ACTIVE<br/>FIBER: INSULATING<br/>RESPONSE: WARMING';
    statusBox.style.color = '#ff9800';
    coolThresh.textContent = '> 30¬∞C Standby';
    heatThresh.textContent = '< 20¬∞C Active';
  } else {
    statusBox.innerHTML = 'STATUS: BALANCED<br/>FIBER: REGULATING<br/>RESPONSE: PASSIVE';
    statusBox.style.color = '#69f0ae';
    coolThresh.textContent = '> 30¬∞C Standby';
    heatThresh.textContent = '< 20¬∞C Standby';
  }
}

// ‚îÄ‚îÄ FABRIC SELECTOR ‚îÄ‚îÄ
function selectFabric(el, idx) {
  document.querySelectorAll('.fabric-item').forEach(e => e.classList.remove('active'));
  el.classList.add('active');
  selectedFabric = idx;
  const f = fabrics[idx];
  document.getElementById('eco-mat').textContent = f.eco;
  document.getElementById('fiber-list').innerHTML = f.fibers.split('\n').join('<br/>');
  showNotif('‚ú¶ ' + f.name + ' selected');
}

// ‚îÄ‚îÄ ROTATE ‚îÄ‚îÄ
function toggleRotate() {
  autoRotate = !autoRotate;
  showNotif(autoRotate ? '‚ú¶ Auto-rotation enabled' : '‚ú¶ Auto-rotation paused');
}

// ‚îÄ‚îÄ NOTIFICATIONS ‚îÄ‚îÄ
function showNotif(msg, duration=2500) {
  const n = document.getElementById('notif');
  n.textContent = msg;
  n.style.display = 'block';
  setTimeout(() => n.style.display = 'none', duration);
}

// ‚îÄ‚îÄ AR MODE ‚îÄ‚îÄ
function enterAR() {
  if (navigator.xr) {
    navigator.xr.isSessionSupported('immersive-ar').then(supported => {
      if (supported) {
        startARSession();
      } else {
        startARSimulation();
      }
    });
  } else {
    startARSimulation();
  }
}

function startARSession() {
  const sessionInit = {
    requiredFeatures: ['hit-test'],
    optionalFeatures: ['dom-overlay'],
    domOverlay: { root: document.getElementById('ar-overlay') }
  };
  navigator.xr.requestSession('immersive-ar', sessionInit).then(session => {
    document.getElementById('mode-badge').textContent = 'AR MODE';
    document.getElementById('ar-overlay').style.display = 'flex';
    showNotif('üì± AR Active ‚Äî Move camera over floor surface', 4000);
  }).catch(err => {
    showNotif('‚ö† AR session failed: ' + err.message, 3000);
    startARSimulation();
  });
}

function startARSimulation() {
  arMode = true;
  arPlaced = false;
  document.getElementById('ar-overlay').style.display = 'flex';
  document.getElementById('mode-badge').textContent = 'AR SIMULATION';
  showNotif('üì± AR Simulation ‚Äî WebXR not available on this device/browser. Tap to place fabric!', 4000);
}

function placeOnSurface() {
  if (!arPlaced) {
    arPlaced = true;
    document.querySelector('.ar-scan-ring').style.borderColor = '#69f0ae';
    document.querySelector('.ar-scan-ring').style.boxShadow = '0 0 30px rgba(105,240,174,0.5)';
    document.querySelector('.ar-hint').textContent = '‚ú¶ FABRIC PLACED ON SURFACE ‚Äî TAP AGAIN TO MOVE';
    showNotif('‚ú¶ ' + fabrics[selectedFabric].name + ' placed on floor surface!', 3000);
  } else {
    arPlaced = false;
    document.querySelector('.ar-scan-ring').style.borderColor = 'var(--cyan)';
    document.querySelector('.ar-scan-ring').style.boxShadow = '0 0 30px rgba(0,229,255,0.4)';
    document.querySelector('.ar-hint').textContent = '‚ú¶ TAP TO PLACE FABRIC ON SURFACE';
  }
}

// ‚îÄ‚îÄ EXIT AR ‚îÄ‚îÄ
document.getElementById('ar-overlay').addEventListener('dblclick', () => {
  document.getElementById('ar-overlay').style.display = 'none';
  document.getElementById('mode-badge').textContent = 'BROWSE MODE';
  arMode = false; arPlaced = false;
  showNotif('‚ú¶ Exited AR mode');
});

// ‚îÄ‚îÄ VR LUXURY SHOWROOM ‚îÄ‚îÄ
function enterVR() {
  if (navigator.xr) {
    navigator.xr.isSessionSupported('immersive-vr').then(supported => {
      if (supported) {
        startVRSession();
      } else {
        startVRDemo();
      }
    });
  } else {
    startVRDemo();
  }
}

function startVRSession() {
  navigator.xr.requestSession('immersive-vr').then(session => {
    document.getElementById('mode-badge').textContent = 'VR MODE';
    showNotif('ü•Ω VR Session Active ‚Äî Luxury Showroom', 4000);
    document.getElementById('vr-demo').style.display = 'block';
    startVRDemo();
  }).catch(() => startVRDemo());
}

let vrAnimFrame;
let vrAngle = 0;

function startVRDemo() {
  document.getElementById('vr-demo').style.display = 'block';
  document.getElementById('mode-badge').textContent = 'VR SHOWROOM';
  showNotif('ü•Ω Luxury Boutique Showroom ‚Äî VR Experience', 3000);
  renderVR();
}

function renderVR() {
  const vc = document.getElementById('vr-canvas');
  vc.width = window.innerWidth;
  vc.height = window.innerHeight;
  const vCtx = vc.getContext('2d');

  function vrLoop(ts) {
    vrAngle += 0.008;
    const t = ts / 1000;
    const vW = vc.width, vH = vc.height;
    const vcx = vW / 2, vcy = vH / 2;
    const f = fabrics[selectedFabric];
    const [c1, c2] = f.colors;

    // Deep luxury background
    const bg = vCtx.createLinearGradient(0, 0, 0, vH);
    bg.addColorStop(0, '#0a0407');
    bg.addColorStop(0.5, '#120810');
    bg.addColorStop(1, '#060304');
    vCtx.fillStyle = bg;
    vCtx.fillRect(0, 0, vW, vH);

    // Ceiling chandelier glow
    const chandelierGlow = vCtx.createRadialGradient(vcx, 0, 0, vcx, 0, vH * 0.8);
    chandelierGlow.addColorStop(0, 'rgba(201,168,76,0.15)');
    chandelierGlow.addColorStop(0.3, 'rgba(201,168,76,0.05)');
    chandelierGlow.addColorStop(1, 'transparent');
    vCtx.fillStyle = chandelierGlow;
    vCtx.fillRect(0, 0, vW, vH);

    // Floor marble
    const floorY = vcy * 1.1;
    const floorGrad = vCtx.createLinearGradient(0, floorY, 0, vH);
    floorGrad.addColorStop(0, '#1a1015');
    floorGrad.addColorStop(1, '#0a0608');
    vCtx.fillStyle = floorGrad;
    vCtx.fillRect(0, floorY, vW, vH - floorY);

    // Marble reflection lines
    vCtx.strokeStyle = 'rgba(201,168,76,0.08)';
    vCtx.lineWidth = 1;
    for (let i = 0; i < 8; i++) {
      const ly = floorY + (i / 8) * (vH - floorY);
      vCtx.beginPath();
      vCtx.moveTo(0, ly);
      vCtx.lineTo(vW, ly);
      vCtx.stroke();
    }

    // Boutique walls (side panels)
    // Left wall
    const leftWall = vCtx.createLinearGradient(0, 0, vW * 0.25, 0);
    leftWall.addColorStop(0, 'rgba(30,15,20,0.95)');
    leftWall.addColorStop(1, 'transparent');
    vCtx.fillStyle = leftWall;
    vCtx.fillRect(0, 0, vW * 0.25, floorY);

    // Right wall
    const rightWall = vCtx.createLinearGradient(vW * 0.75, 0, vW, 0);
    rightWall.addColorStop(0, 'transparent');
    rightWall.addColorStop(1, 'rgba(30,15,20,0.95)');
    vCtx.fillStyle = rightWall;
    vCtx.fillRect(vW * 0.75, 0, vW * 0.25, floorY);

    // Gold wall trim
    vCtx.strokeStyle = 'rgba(201,168,76,0.4)';
    vCtx.lineWidth = 2;
    // Baseboard
    vCtx.beginPath();
    vCtx.moveTo(0, floorY);
    vCtx.lineTo(vW, floorY);
    vCtx.stroke();
    // Crown molding
    vCtx.beginPath();
    vCtx.moveTo(0, vH * 0.06);
    vCtx.lineTo(vW, vH * 0.06);
    vCtx.stroke();

    // Fabric mannequins (3 rotating displays)
    for (let i = 0; i < 3; i++) {
      const manAngle = vrAngle + (i * Math.PI * 2 / 3);
      const rx = 180;
      const mx = vcx + Math.sin(manAngle) * rx;
      const mz = Math.cos(manAngle);
      const mScale = 0.6 + mz * 0.3;
      const mAlpha = 0.4 + (mz + 1) * 0.3;

      if (mz < -0.3) continue; // behind camera

      const fi = (selectedFabric + i) % fabrics.length;
      const [fc1, fc2] = fabrics[fi].colors;

      vCtx.save();
      vCtx.globalAlpha = mAlpha;
      vCtx.translate(mx, floorY - 40 * mScale);
      vCtx.scale(mScale, mScale);

      // Mannequin glow
      const glow = vCtx.createRadialGradient(0, 0, 0, 0, 0, 100);
      glow.addColorStop(0, fc1 + '33');
      glow.addColorStop(1, 'transparent');
      vCtx.fillStyle = glow;
      vCtx.fillRect(-100, -200, 200, 300);

      // Body
      const bGrad = vCtx.createLinearGradient(-35, -200, 35, 60);
      bGrad.addColorStop(0, fc1);
      bGrad.addColorStop(1, fc2);
      vCtx.fillStyle = bGrad;
      vCtx.shadowBlur = 20;
      vCtx.shadowColor = fc1;
      vCtx.beginPath();
      vCtx.ellipse(0, -80, 32, 80, 0, 0, Math.PI*2);
      vCtx.fill();

      // Head
      vCtx.fillStyle = '#c8a882';
      vCtx.shadowBlur = 0;
      vCtx.beginPath();
      vCtx.ellipse(0, -180, 16, 20, 0, 0, Math.PI*2);
      vCtx.fill();

      // Spotlight
      const spot = vCtx.createRadialGradient(0, 60, 0, 0, 60, 80);
      spot.addColorStop(0, 'rgba(201,168,76,0.2)');
      spot.addColorStop(1, 'transparent');
      vCtx.fillStyle = spot;
      vCtx.ellipse(0, 60, 70, 20, 0, 0, Math.PI*2);
      vCtx.fill();

      vCtx.restore();
    }

    // Center feature mannequin (main selected)
    {
      const f = fabrics[selectedFabric];
      const [c1,c2,c3] = f.colors;
      vCtx.save();
      vCtx.translate(vcx, floorY - 100);

      // Grand spotlight from ceiling
      const spotlight = vCtx.createRadialGradient(vcx, 0, 0, vcx, 0, floorY);
      spotlight.addColorStop(0, 'rgba(201,168,76,0.12)');
      spotlight.addColorStop(0.7, 'rgba(201,168,76,0.03)');
      spotlight.addColorStop(1, 'transparent');
      vCtx.fillStyle = spotlight;
      vCtx.fillRect(-vW/2, -floorY, vW, floorY);

      // Glow aura
      const aura = vCtx.createRadialGradient(0, 0, 0, 0, 0, 250);
      aura.addColorStop(0, c1 + '55');
      aura.addColorStop(1, 'transparent');
      vCtx.fillStyle = aura;
      vCtx.fillRect(-250, -350, 500, 500);

      // Saree body
      const bodyGrad = vCtx.createLinearGradient(-60, -300, 60, 100);
      bodyGrad.addColorStop(0, c1);
      bodyGrad.addColorStop(0.5, c2);
      bodyGrad.addColorStop(1, c2 + 'bb');
      vCtx.fillStyle = bodyGrad;
      vCtx.shadowBlur = 40;
      vCtx.shadowColor = c1;
      vCtx.beginPath();
      vCtx.ellipse(0, -130, 65, 170, 0, 0, Math.PI * 2);
      vCtx.fill();

      // Pallu
      const pallu = vCtx.createLinearGradient(-80, -250, 80, 100);
      pallu.addColorStop(0, c3 + 'dd');
      pallu.addColorStop(1, c1 + '77');
      vCtx.fillStyle = pallu;
      vCtx.beginPath();
      vCtx.moveTo(-25, -250);
      vCtx.quadraticCurveTo(-100, -100, -80, 100);
      vCtx.quadraticCurveTo(-40, 120, 15, 100);
      vCtx.quadraticCurveTo(-15, -100, 25, -250);
      vCtx.closePath();
      vCtx.fill();

      // Head
      vCtx.fillStyle = '#c8a882';
      vCtx.shadowBlur = 0;
      vCtx.beginPath();
      vCtx.ellipse(0, -310, 32, 40, 0, 0, Math.PI*2);
      vCtx.fill();

      // Fiber light lines
      vCtx.globalAlpha = 0.5 + Math.sin(t * 4) * 0.3;
      vCtx.strokeStyle = f.hue === 'cool' ? '#00e5ff' : f.hue === 'warm' ? '#ffd54f' : f.hue === 'natural' ? '#69f0ae' : '#ea80fc';
      vCtx.lineWidth = 1.5;
      vCtx.shadowBlur = 12;
      vCtx.shadowColor = vCtx.strokeStyle;
      for (let i = 0; i < 6; i++) {
        const lx = -40 + i * 16;
        vCtx.beginPath();
        vCtx.moveTo(lx, -250);
        vCtx.lineTo(lx - 8, 100);
        vCtx.stroke();
      }

      vCtx.restore();
    }

    // Brand watermark
    vCtx.globalAlpha = 0.3;
    vCtx.fillStyle = '#c9a84c';
    vCtx.font = '300 11px "Cormorant Garamond", serif';
    vCtx.letterSpacing = '0.4em';
    vCtx.textAlign = 'center';
    vCtx.fillText('V A S T R A V E R S E  ¬∑  L U X U R Y  B O U T I Q U E', vcx, 40);
    vCtx.globalAlpha = 1;

    // HUD labels
    vCtx.font = '500 12px Rajdhani';
    vCtx.letterSpacing = '0.15em';
    vCtx.fillStyle = 'rgba(201,168,76,0.7)';
    vCtx.textAlign = 'center';
    vCtx.fillText(f.name.toUpperCase(), vcx, floorY - 240);

    vrAnimFrame = requestAnimationFrame(vrLoop);
  }
  vrAnimFrame = requestAnimationFrame(vrLoop);
}

function exitVR() {
  cancelAnimationFrame(vrAnimFrame);
  document.getElementById('vr-demo').style.display = 'none';
  document.getElementById('mode-badge').textContent = 'BROWSE MODE';
  showNotif('‚ú¶ Exited VR Showroom');
}

// ‚îÄ‚îÄ DRAG TO ROTATE ‚îÄ‚îÄ
let dragging = false, lastX = 0;
canvas.addEventListener('mousedown', e => { dragging = true; lastX = e.clientX; autoRotate = false; });
canvas.addEventListener('mousemove', e => {
  if (dragging) { angle += (e.clientX - lastX) * 0.005; lastX = e.clientX; }
});
canvas.addEventListener('mouseup', () => dragging = false);
canvas.addEventListener('touchstart', e => { dragging = true; lastX = e.touches[0].clientX; autoRotate = false; });
canvas.addEventListener('touchmove', e => {
  if (dragging) { angle += (e.touches[0].clientX - lastX) * 0.005; lastX = e.touches[0].clientX; }
  e.preventDefault();
}, {passive: false});
canvas.addEventListener('touchend', () => dragging = false);
</script>
</body>
</html>
