<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VastraVerse ¬∑ SmartWeave XR</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;500;600;700&family=Orbitron:wght@400;700;900&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap');

  :root {
    --gold: #c9a84c;
    --gold-light: #f0d080;
    --cyan: #00ffe7;
    --magenta: #ff2d78;
    --green: #39ff14;
    --dark: #050810;
    --dark2: #0a0f1e;
    --dark3: #0f1628;
    --panel: rgba(10,20,50,0.85);
    --border: rgba(201,168,76,0.3);
    --text: #d0ddf5;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Rajdhani', sans-serif;
    background: var(--dark);
    color: var(--text);
    overflow: hidden;
    width: 100vw;
    height: 100vh;
    user-select: none;
  }

  /* ‚îÄ‚îÄ CANVAS LAYERS ‚îÄ‚îÄ */
  #xr-canvas {
    position: fixed; inset: 0;
    width: 100%; height: 100%;
    z-index: 0;
  }

  #particles {
    position: fixed; inset: 0;
    width: 100%; height: 100%;
    z-index: 1;
    pointer-events: none;
  }

  /* ‚îÄ‚îÄ GRID OVERLAY ‚îÄ‚îÄ */
  .grid-overlay {
    position: fixed; inset: 0;
    z-index: 2;
    pointer-events: none;
    background-image:
      linear-gradient(rgba(0,255,231,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,255,231,0.03) 1px, transparent 1px);
    background-size: 60px 60px;
  }

  /* ‚îÄ‚îÄ NOTIFICATION ‚îÄ‚îÄ */
  #notif {
    position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
    z-index: 200;
    background: rgba(0,255,231,0.15);
    border: 1px solid var(--cyan);
    color: var(--cyan);
    font-family: 'Space Mono', monospace;
    font-size: 12px;
    padding: 10px 24px;
    border-radius: 2px;
    letter-spacing: 2px;
    display: none;
    animation: notifPop 0.3s ease;
  }
  @keyframes notifPop {
    from { opacity: 0; transform: translateX(-50%) translateY(-10px); }
    to   { opacity: 1; transform: translateX(-50%) translateY(0); }
  }

  /* ‚îÄ‚îÄ AR OVERLAY ‚îÄ‚îÄ */
  #ar-overlay {
    display: none;
    position: fixed; inset: 0;
    z-index: 150;
    background: transparent;
  }

  #ar-overlay.active { display: block; }

  .ar-corner {
    position: absolute;
    width: 60px; height: 60px;
    border-color: var(--cyan);
    border-style: solid;
    opacity: 0.8;
  }
  .ar-corner.tl { top: 40px; left: 40px; border-width: 3px 0 0 3px; }
  .ar-corner.tr { top: 40px; right: 40px; border-width: 3px 3px 0 0; }
  .ar-corner.bl { bottom: 40px; left: 40px; border-width: 0 0 3px 3px; }
  .ar-corner.br { bottom: 40px; right: 40px; border-width: 0 3px 3px 0; }

  .ar-scan-line {
    position: absolute;
    left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--cyan), transparent);
    top: 0;
    animation: scan 3s linear infinite;
    opacity: 0.7;
  }
  @keyframes scan {
    0% { top: 0%; }
    100% { top: 100%; }
  }

  .ar-label {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    font-family: 'Space Mono', monospace;
    color: var(--cyan);
    font-size: 11px;
    letter-spacing: 3px;
    background: rgba(0,0,0,0.6);
    padding: 8px 20px;
    border: 1px solid rgba(0,255,231,0.3);
  }

  .ar-dot {
    position: absolute;
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--cyan);
    box-shadow: 0 0 10px var(--cyan);
    animation: pulse 1.5s ease infinite;
  }
  @keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.5); opacity: 0.5; }
  }

  #ar-close {
    position: absolute;
    top: 20px; right: 20px;
    background: rgba(255,45,120,0.2);
    border: 1px solid var(--magenta);
    color: var(--magenta);
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    letter-spacing: 2px;
    padding: 8px 16px;
    cursor: pointer;
    z-index: 160;
  }
  #ar-close:hover { background: rgba(255,45,120,0.4); }

  /* ‚îÄ‚îÄ VR DEMO ‚îÄ‚îÄ */
  #vr-demo {
    display: none;
    position: fixed; inset: 0;
    z-index: 160;
    background: #000;
  }
  #vr-demo.active { display: flex; }

  #vr-canvas {
    width: 100%; height: 100%;
    display: block;
  }

  #vr-ui {
    position: absolute;
    bottom: 30px; left: 50%;
    transform: translateX(-50%);
    display: flex; gap: 20px;
    z-index: 170;
  }

  .vr-btn {
    font-family: 'Orbitron', monospace;
    font-size: 10px;
    letter-spacing: 2px;
    padding: 10px 24px;
    border: 1px solid;
    cursor: pointer;
    background: rgba(0,0,0,0.5);
    transition: all 0.2s;
  }
  .vr-btn.exit { border-color: var(--magenta); color: var(--magenta); }
  .vr-btn.exit:hover { background: rgba(255,45,120,0.3); }
  .vr-btn.rotate { border-color: var(--gold); color: var(--gold); }
  .vr-btn.rotate:hover { background: rgba(201,168,76,0.3); }

  #vr-label {
    position: absolute;
    top: 20px; left: 50%;
    transform: translateX(-50%);
    font-family: 'Orbitron', sans-serif;
    font-size: 12px;
    letter-spacing: 4px;
    color: var(--gold);
    text-shadow: 0 0 20px var(--gold);
  }

  /* ‚îÄ‚îÄ MAIN UI ‚îÄ‚îÄ */
  #ui {
    position: fixed; inset: 0;
    z-index: 10;
    pointer-events: none;
    display: grid;
    grid-template-columns: 280px 1fr 220px;
    grid-template-rows: 70px 1fr 120px;
    gap: 0;
  }

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  .header {
    grid-column: 1 / -1;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 30px;
    border-bottom: 1px solid var(--border);
    background: linear-gradient(180deg, rgba(5,8,16,0.95) 0%, rgba(5,8,16,0.6) 100%);
    pointer-events: all;
    backdrop-filter: blur(10px);
  }

  .logo {
    font-family: 'Orbitron', sans-serif;
    font-size: 18px;
    font-weight: 700;
    letter-spacing: 6px;
    color: var(--gold);
    text-shadow: 0 0 30px rgba(201,168,76,0.5);
  }

  .logo span {
    color: var(--text);
    font-weight: 400;
  }

  .logo-sub {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 8px;
    color: rgba(201,168,76,0.5);
    margin-top: 2px;
  }

  .browse-mode-btn {
    font-family: 'Orbitron', sans-serif;
    font-size: 9px;
    letter-spacing: 3px;
    border: 1px solid var(--gold);
    color: var(--gold);
    padding: 8px 20px;
    background: transparent;
    cursor: pointer;
    pointer-events: all;
    transition: all 0.3s;
  }
  .browse-mode-btn:hover {
    background: rgba(201,168,76,0.15);
    box-shadow: 0 0 20px rgba(201,168,76,0.3);
  }

  /* ‚îÄ‚îÄ LEFT PANEL ‚îÄ‚îÄ */
  .left-panel {
    grid-column: 1;
    grid-row: 2;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    pointer-events: all;
    background: linear-gradient(90deg, rgba(5,8,16,0.9) 0%, transparent 100%);
  }

  .sensor-panel {
    background: var(--panel);
    border: 1px solid rgba(0,255,231,0.25);
    border-top: 2px solid var(--cyan);
    padding: 16px;
    position: relative;
    overflow: hidden;
  }

  .sensor-panel::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 100%;
    background: linear-gradient(180deg, rgba(0,255,231,0.05) 0%, transparent 50%);
    pointer-events: none;
  }

  .panel-label {
    font-family: 'Space Mono', monospace;
    font-size: 8px;
    letter-spacing: 4px;
    color: rgba(0,255,231,0.6);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .panel-label::before {
    content: '';
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--cyan);
    box-shadow: 0 0 8px var(--cyan);
    animation: pulse 1.5s ease infinite;
  }

  .temp-display {
    font-family: 'Orbitron', sans-serif;
    font-size: 52px;
    font-weight: 900;
    color: var(--text);
    line-height: 1;
    margin-bottom: 4px;
  }
  .temp-display sup {
    font-size: 18px;
    color: var(--cyan);
  }

  .temp-slider-wrap {
    margin: 12px 0;
    position: relative;
  }
  .temp-slider {
    -webkit-appearance: none;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, #0088ff, #ffaa00, #ff2200);
    border-radius: 2px;
    outline: none;
    cursor: pointer;
  }
  .temp-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 16px; height: 16px;
    border-radius: 50%;
    background: var(--gold);
    box-shadow: 0 0 10px var(--gold);
    cursor: pointer;
  }

  .status-box {
    background: rgba(0,0,0,0.4);
    border-left: 2px solid var(--cyan);
    padding: 8px 12px;
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 1px;
    line-height: 1.8;
    color: var(--cyan);
  }

  .status-box .status-line { color: var(--green); }

  /* Fabric Collection */
  .fabric-panel {
    background: var(--panel);
    border: 1px solid var(--border);
    border-top: 2px solid var(--gold);
    padding: 16px;
    flex: 1;
  }

  .fabric-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px;
    border: 1px solid transparent;
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 4px;
  }
  .fabric-item:hover, .fabric-item.active {
    border-color: rgba(201,168,76,0.4);
    background: rgba(201,168,76,0.08);
  }
  .fabric-dot {
    width: 32px; height: 32px;
    border-radius: 50%;
    flex-shrink: 0;
    position: relative;
  }
  .fabric-dot::after {
    content: '';
    position: absolute; inset: 3px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
  }
  .fabric-info .name {
    font-family: 'Rajdhani', sans-serif;
    font-weight: 600;
    font-size: 14px;
    color: var(--text);
  }
  .fabric-info .tag {
    font-family: 'Space Mono', monospace;
    font-size: 8px;
    letter-spacing: 2px;
    color: rgba(208,221,245,0.4);
  }

  /* ‚îÄ‚îÄ RIGHT PANEL ‚îÄ‚îÄ */
  .right-panel {
    grid-column: 3;
    grid-row: 2;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    pointer-events: all;
    background: linear-gradient(270deg, rgba(5,8,16,0.9) 0%, transparent 100%);
  }

  .stat-card {
    background: var(--panel);
    border: 1px solid var(--border);
    padding: 12px 14px;
    border-left: 3px solid var(--gold);
    transition: border-color 0.3s;
    cursor: default;
  }
  .stat-card:hover { border-left-color: var(--cyan); }
  .stat-card.cooling { border-left-color: #00aaff; }
  .stat-card.heating { border-left-color: #ff6600; }
  .stat-card.eco { border-left-color: var(--green); }
  .stat-card.smart { border-left-color: #ffdd00; }

  .stat-label {
    font-family: 'Space Mono', monospace;
    font-size: 7px;
    letter-spacing: 3px;
    opacity: 0.5;
    margin-bottom: 4px;
  }
  .stat-value {
    font-family: 'Orbitron', sans-serif;
    font-size: 14px;
    font-weight: 700;
    color: var(--text);
  }

  .fiber-card {
    background: var(--panel);
    border: 1px solid var(--border);
    padding: 14px;
    flex: 1;
  }
  .fiber-card .panel-label { color: rgba(201,168,76,0.6); }
  .fiber-card .panel-label::before { background: var(--gold); box-shadow: 0 0 8px var(--gold); }

  .fiber-item {
    font-family: 'Space Mono', monospace;
    font-size: 9px;
    letter-spacing: 1px;
    color: rgba(208,221,245,0.6);
    padding: 6px 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .fiber-item::before {
    content: '‚ñ∏';
    color: var(--gold);
    font-size: 8px;
  }

  /* ‚îÄ‚îÄ BOTTOM BUTTONS ‚îÄ‚îÄ */
  .bottom-bar {
    grid-column: 1 / -1;
    grid-row: 3;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 2px;
    padding: 0 30px;
    border-top: 1px solid var(--border);
    background: linear-gradient(0deg, rgba(5,8,16,0.95) 0%, rgba(5,8,16,0.6) 100%);
    backdrop-filter: blur(10px);
    pointer-events: all;
  }

  .xr-btn {
    flex: 1;
    max-width: 320px;
    height: 80px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 4px;
    border: 1px solid;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
    background: transparent;
    font-family: inherit;
  }

  .xr-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    opacity: 0;
    transition: opacity 0.3s;
  }
  .xr-btn:hover::before { opacity: 1; }

  .xr-btn.ar {
    border-color: rgba(0,255,231,0.5);
    color: var(--cyan);
  }
  .xr-btn.ar::before { background: rgba(0,255,231,0.07); }
  .xr-btn.ar:hover { border-color: var(--cyan); box-shadow: 0 0 30px rgba(0,255,231,0.2); }

  .xr-btn.rotate-btn {
    border-color: rgba(201,168,76,0.5);
    color: var(--gold);
  }
  .xr-btn.rotate-btn::before { background: rgba(201,168,76,0.07); }
  .xr-btn.rotate-btn:hover { border-color: var(--gold); box-shadow: 0 0 30px rgba(201,168,76,0.2); }

  .xr-btn.vr {
    border-color: rgba(255,45,120,0.5);
    color: var(--magenta);
  }
  .xr-btn.vr::before { background: rgba(255,45,120,0.07); }
  .xr-btn.vr:hover { border-color: var(--magenta); box-shadow: 0 0 30px rgba(255,45,120,0.2); }

  .btn-icon {
    font-size: 20px;
    line-height: 1;
  }
  .btn-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 3px;
  }
  .btn-sub {
    font-family: 'Space Mono', monospace;
    font-size: 7px;
    letter-spacing: 2px;
    opacity: 0.5;
  }

  /* ‚îÄ‚îÄ MANNEQUIN AREA ‚îÄ‚îÄ */
  .center-area {
    grid-column: 2;
    grid-row: 2;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #mannequin-canvas {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
  }

  .scan-ring {
    position: absolute;
    border-radius: 50%;
    border: 1px solid rgba(0,255,231,0.15);
    animation: ringExpand 4s ease-in-out infinite;
  }
  .scan-ring:nth-child(1) { width: 200px; height: 200px; animation-delay: 0s; }
  .scan-ring:nth-child(2) { width: 300px; height: 300px; animation-delay: 1s; }
  .scan-ring:nth-child(3) { width: 400px; height: 400px; animation-delay: 2s; }

  @keyframes ringExpand {
    0%, 100% { opacity: 0; transform: scale(0.8); }
    50% { opacity: 1; transform: scale(1); }
  }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 0; }

  /* Scanline effect */
  body::after {
    content: '';
    position: fixed; inset: 0;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(0,0,0,0.03) 2px,
      rgba(0,0,0,0.03) 4px
    );
    pointer-events: none;
    z-index: 300;
  }
</style>
</head>
<body>

<!-- Canvas layers -->
<canvas id="xr-canvas"></canvas>
<canvas id="particles"></canvas>
<div class="grid-overlay"></div>

<!-- Notification -->
<div id="notif"></div>

<!-- AR Overlay -->
<div id="ar-overlay">
  <div class="ar-corner tl"></div>
  <div class="ar-corner tr"></div>
  <div class="ar-corner bl"></div>
  <div class="ar-corner br"></div>
  <div class="ar-scan-line"></div>
  <div class="ar-label">‚óà SURFACE DETECTION ACTIVE ‚óà<br><small style="font-size:9px;opacity:0.6">Point camera at flat surface</small></div>
  <div class="ar-dot" style="top:30%;left:25%"></div>
  <div class="ar-dot" style="top:60%;left:70%;animation-delay:0.5s"></div>
  <div class="ar-dot" style="top:45%;left:50%;animation-delay:1s"></div>
  <canvas id="ar-3d-canvas" style="position:absolute;inset:0;width:100%;height:100%;"></canvas>
  <button id="ar-close" onclick="closeAR()">‚úï EXIT AR</button>
</div>

<!-- VR Demo -->
<div id="vr-demo">
  <canvas id="vr-canvas"></canvas>
  <div id="vr-label">‚óà VR LUXURY SHOWROOM ‚óà</div>
  <div id="vr-ui">
    <button class="vr-btn rotate" onclick="toggleVRRotate()">‚ü≥ AUTO ROTATE</button>
    <button class="vr-btn exit" onclick="closeVR()">EXIT VR</button>
  </div>
</div>

<!-- Main UI -->
<div id="ui">
  <!-- Header -->
  <div class="header">
    <div>
      <div class="logo">VASTRA<span>VERSE</span> ¬∑ <span>SMART</span>WEAVE</div>
      <div class="logo-sub">NANO-THERMAL INTELLIGENT FABRIC SYSTEM v2.4</div>
    </div>
    <button class="browse-mode-btn" onclick="notify('BROWSE MODE ACTIVATED')">BROWSE MODE</button>
  </div>

  <!-- Left Panel -->
  <div class="left-panel">
    <!-- Sensor -->
    <div class="sensor-panel">
      <div class="panel-label">AMBIENT SENSOR</div>
      <div class="temp-display" id="temp-val">44<sup>¬∞C</sup></div>
      <div class="temp-slider-wrap">
        <input type="range" class="temp-slider" id="temp-slider" min="15" max="50" value="44" oninput="updateTemp(this.value)">
      </div>
      <div class="status-box" id="status-box">
        STATUS: <span class="status-line" id="status-mode">COOLING ACTIVE</span><br>
        FIBER: <span id="fiber-mode">VENTILATING</span><br>
        RESPONSE: <span style="color:var(--green)">OPTIMAL</span>
      </div>
    </div>

    <!-- Fabric Collection -->
    <div class="fabric-panel">
      <div class="panel-label">FABRIC COLLECTION</div>
      <div class="fabric-item active" onclick="selectFabric(this,'Kanchipuram Silk','#c06030','NANO-THERMAL ¬∑ ECO')">
        <div class="fabric-dot" style="background:radial-gradient(#e07840,#803020)"></div>
        <div class="fabric-info">
          <div class="name">Kanchipuram Silk</div>
          <div class="tag">NANO-THERMAL ¬∑ ECO</div>
        </div>
      </div>
      <div class="fabric-item" onclick="selectFabric(this,'Cool Banarasi','#2050c0','GRAPHENE GRID')">
        <div class="fabric-dot" style="background:radial-gradient(#4080f0,#102060)"></div>
        <div class="fabric-info">
          <div class="name">Cool Banarasi</div>
          <div class="tag">GRAPHENE GRID</div>
        </div>
      </div>
      <div class="fabric-item" onclick="selectFabric(this,'Organic Khadi','#50b050','MOISTURE-WICK')">
        <div class="fabric-dot" style="background:radial-gradient(#80e080,#206020)"></div>
        <div class="fabric-info">
          <div class="name">Organic Khadi</div>
          <div class="tag">MOISTURE-WICK</div>
        </div>
      </div>
      <div class="fabric-item" onclick="selectFabric(this,'Smart Chanderi','#c030c0','PHASE-CHANGE')">
        <div class="fabric-dot" style="background:radial-gradient(#e060e0,#601060)"></div>
        <div class="fabric-info">
          <div class="name">Smart Chanderi</div>
          <div class="tag">PHASE-CHANGE</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Center (empty - canvas draws here) -->
  <div class="center-area">
    <div class="scan-ring"></div>
    <div class="scan-ring"></div>
    <div class="scan-ring"></div>
  </div>

  <!-- Right Panel -->
  <div class="right-panel">
    <div class="stat-card cooling">
      <div class="stat-label">‚ùÑ COOLING THRESHOLD</div>
      <div class="stat-value">> 30¬∞C Active</div>
    </div>
    <div class="stat-card heating">
      <div class="stat-label">üî• HEATING THRESHOLD</div>
      <div class="stat-value">< 20¬∞C Active</div>
    </div>
    <div class="stat-card eco">
      <div class="stat-label">üåø ECO MATERIAL</div>
      <div class="stat-value" id="eco-mat">Organic Silk</div>
    </div>
    <div class="stat-card smart">
      <div class="stat-label">‚ö° SMART RESPONSE</div>
      <div class="stat-value">98% Optimal</div>
    </div>
    <div class="fiber-card">
      <div class="panel-label">FIBER ANALYSIS</div>
      <div class="fiber-item">Cooling Nano-Polymer</div>
      <div class="fiber-item">Graphene Thermal Grid</div>
      <div class="fiber-item">Moisture-wicking Core</div>
      <div class="fiber-item">Bio-reactive Layer</div>
    </div>
  </div>

  <!-- Bottom Bar -->
  <div class="bottom-bar">
    <button class="xr-btn ar" onclick="openAR()">
      <div class="btn-icon">üì±</div>
      <div class="btn-title">ENTER AR</div>
      <div class="btn-sub">SURFACE DETECTION</div>
    </button>
    <button class="xr-btn rotate-btn" onclick="toggleRotate()">
      <div class="btn-icon">‚ü≥</div>
      <div class="btn-title">ROTATE VIEW</div>
      <div class="btn-sub">INTERACTIVE 3D</div>
    </button>
    <button class="xr-btn vr" onclick="openVR()">
      <div class="btn-icon">ü•Ω</div>
      <div class="btn-title">ENTER VR</div>
      <div class="btn-sub">LUXURY SHOWROOM</div>
    </button>
  </div>
</div>

<script>
// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
// STATE
// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
let currentFabricColor = { r: 192, g: 96, b: 48 };
let targetFabricColor  = { r: 192, g: 96, b: 48 };
let isRotating = false;
let mannequinAngle = 0;
let vrAutoRotate = true;
let vrAngle = 0;
let animFrame;

// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
// BACKGROUND XR CANVAS (grid + glow)
// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
const bgCanvas = document.getElementById('xr-canvas');
const bgCtx = bgCanvas.getContext('2d');

function resizeBg() {
  bgCanvas.width  = window.innerWidth;
  bgCanvas.height = window.innerHeight;
}
resizeBg();
window.addEventListener('resize', resizeBg);

let bgT = 0;
function drawBg() {
  bgT += 0.008;
  const W = bgCanvas.width, H = bgCanvas.height;
  bgCtx.fillStyle = '#050810';
  bgCtx.fillRect(0,0,W,H);

  // Radial glow center
  const gx = W * 0.5 + Math.sin(bgT * 0.3) * 80;
  const gy = H * 0.5 + Math.cos(bgT * 0.2) * 50;
  const g = bgCtx.createRadialGradient(gx, gy, 0, gx, gy, 450);
  g.addColorStop(0, `rgba(${currentFabricColor.r*0.5},${currentFabricColor.g*0.2},${currentFabricColor.b*0.1},0.25)`);
  g.addColorStop(0.5, 'rgba(0,20,60,0.1)');
  g.addColorStop(1, 'transparent');
  bgCtx.fillStyle = g;
  bgCtx.fillRect(0,0,W,H);

  // Secondary glow (cyan)
  const g2 = bgCtx.createRadialGradient(W*0.8, H*0.8, 0, W*0.8, H*0.8, 300);
  g2.addColorStop(0, 'rgba(0,255,231,0.08)');
  g2.addColorStop(1, 'transparent');
  bgCtx.fillStyle = g2;
  bgCtx.fillRect(0,0,W,H);
}

// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
// PARTICLES
// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
const pCanvas = document.getElementById('particles');
const pCtx = pCanvas.getContext('2d');

function resizeP() {
  pCanvas.width  = window.innerWidth;
  pCanvas.height = window.innerHeight;
}
resizeP();
window.addEventListener('resize', resizeP);

const particles = Array.from({length: 80}, () => ({
  x: Math.random() * window.innerWidth,
  y: Math.random() * window.innerHeight,
  r: Math.random() * 1.5 + 0.2,
  vx: (Math.random() - 0.5) * 0.3,
  vy: -Math.random() * 0.4 - 0.1,
  alpha: Math.random(),
  life: Math.random()
}));

function drawParticles() {
  pCtx.clearRect(0,0,pCanvas.width, pCanvas.height);
  particles.forEach(p => {
    p.x += p.vx; p.y += p.vy; p.life += 0.005;
    if (p.y < 0 || p.life > 1) {
      p.y = pCanvas.height;
      p.x = Math.random() * pCanvas.width;
      p.life = 0;
    }
    const a = Math.sin(p.life * Math.PI) * 0.6;
    pCtx.beginPath();
    pCtx.arc(p.x, p.y, p.r, 0, Math.PI*2);
    pCtx.fillStyle = `rgba(0,255,231,${a})`;
    pCtx.fill();
  });
}

// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
// MANNEQUIN 3D (center canvas)
// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
const mCanvas = document.createElement('canvas');
mCanvas.id = 'mannequin-canvas';
mCanvas.style.cssText = 'position:absolute;inset:0;width:100%;height:100%;pointer-events:auto;';
document.querySelector('.center-area').appendChild(mCanvas);
const mCtx = mCanvas.getContext('2d');

function resizeM() {
  const area = document.querySelector('.center-area').getBoundingClientRect();
  mCanvas.width  = area.width;
  mCanvas.height = area.height;
}

// Drag to rotate
let dragging = false, lastX = 0;
mCanvas.addEventListener('mousedown', e => { dragging = true; lastX = e.clientX; });
window.addEventListener('mousemove', e => {
  if (!dragging) return;
  mannequinAngle += (e.clientX - lastX) * 0.01;
  lastX = e.clientX;
});
window.addEventListener('mouseup', () => dragging = false);

// Touch
mCanvas.addEventListener('touchstart', e => { dragging = true; lastX = e.touches[0].clientX; }, {passive:true});
window.addEventListener('touchmove', e => {
  if (!dragging) return;
  mannequinAngle += (e.touches[0].clientX - lastX) * 0.01;
  lastX = e.touches[0].clientX;
}, {passive:true});
window.addEventListener('touchend', () => dragging = false);

function lerp(a,b,t){ return a + (b-a)*t; }

function draw3DMannequin(ctx, W, H, angle, fabricCol, mode) {
  const cx = W/2, cy = H/2;
  const scale = Math.min(W,H) / 500;

  // Color lerp
  currentFabricColor.r = lerp(currentFabricColor.r, targetFabricColor.r, 0.05);
  currentFabricColor.g = lerp(currentFabricColor.g, targetFabricColor.g, 0.05);
  currentFabricColor.b = lerp(currentFabricColor.b, targetFabricColor.b, 0.05);

  const cr = Math.round(currentFabricColor.r);
  const cg = Math.round(currentFabricColor.g);
  const cb = Math.round(currentFabricColor.b);

  const cos = Math.cos(angle);
  const depth = cos;

  // Shadow
  const sg = ctx.createRadialGradient(cx, cy+200*scale, 0, cx, cy+200*scale, 100*scale);
  sg.addColorStop(0, 'rgba(0,0,0,0.4)');
  sg.addColorStop(1, 'transparent');
  ctx.fillStyle = sg;
  ctx.beginPath();
  ctx.ellipse(cx, cy+200*scale, 100*scale, 30*scale, 0, 0, Math.PI*2);
  ctx.fill();

  // ‚îÄ‚îÄ DRESS / GARMENT ‚îÄ‚îÄ
  // Main dress body
  const dressGrad = ctx.createLinearGradient(cx-80*scale, cy-50*scale, cx+80*scale, cy+200*scale);
  const light = depth > 0;
  const face1 = `rgba(${cr+40},${cg+20},${cb+10},1)`;
  const face2 = `rgba(${cr},${cg},${cb},1)`;
  const face3 = `rgba(${Math.max(0,cr-40)},${Math.max(0,cg-20)},${Math.max(0,cb-10)},1)`;
  dressGrad.addColorStop(0, light ? face1 : face3);
  dressGrad.addColorStop(0.5, face2);
  dressGrad.addColorStop(1, light ? face3 : face1);

  // Dress outline (skirt flare)
  ctx.save();
  ctx.translate(cx, cy);

  // Waist/skirt
  ctx.beginPath();
  ctx.moveTo(-40*scale, -20*scale);
  ctx.bezierCurveTo(-45*scale, 60*scale, -85*scale, 120*scale, -90*scale, 200*scale);
  ctx.lineTo(90*scale, 200*scale);
  ctx.bezierCurveTo(85*scale, 120*scale, 45*scale, 60*scale, 40*scale, -20*scale);
  ctx.closePath();
  ctx.fillStyle = dressGrad;
  ctx.fill();

  // Fabric shimmer lines
  ctx.strokeStyle = `rgba(${cr+80},${cg+60},${cb+40},0.3)`;
  ctx.lineWidth = 1;
  for(let i = -70; i <= 70; i += 14) {
    const x = i * scale;
    const yTop = -20*scale + Math.abs(i)*0.1*scale;
    const yBot = 200*scale;
    ctx.beginPath();
    ctx.moveTo(x, yTop);
    ctx.bezierCurveTo(x + i*0.3*scale, 60*scale, x + i*0.5*scale, 130*scale, x + i*0.6*scale, yBot);
    ctx.stroke();
  }

  // Bodice
  const bodiceG = ctx.createLinearGradient(-40*scale, -100*scale, 40*scale, -20*scale);
  bodiceG.addColorStop(0, `rgba(${cr+60},${cg+30},${cb+20},1)`);
  bodiceG.addColorStop(1, `rgba(${cr-20},${cg-10},${cb-5},1)`);
  ctx.beginPath();
  ctx.moveTo(-40*scale, -20*scale);
  ctx.bezierCurveTo(-42*scale, -60*scale, -35*scale, -100*scale, -20*scale, -110*scale);
  ctx.lineTo(20*scale, -110*scale);
  ctx.bezierCurveTo(35*scale, -100*scale, 42*scale, -60*scale, 40*scale, -20*scale);
  ctx.closePath();
  ctx.fillStyle = bodiceG;
  ctx.fill();

  // Border/trim
  ctx.strokeStyle = `rgba(${Math.min(255,cr+100)},${Math.min(255,cg+80)},${Math.min(255,cb+60)},0.8)`;
  ctx.lineWidth = 2*scale;
  ctx.stroke();

  // Collar
  ctx.beginPath();
  ctx.ellipse(0, -115*scale, 22*scale, 10*scale, 0, 0, Math.PI*2);
  ctx.fillStyle = `rgba(${cr+60},${cg+40},${cb+30},0.9)`;
  ctx.fill();
  ctx.strokeStyle = `rgba(255,255,255,0.3)`;
  ctx.lineWidth = 1;
  ctx.stroke();

  // Head (mannequin)
  const headG = ctx.createRadialGradient(-5*scale, -155*scale, 2*scale, 0, -150*scale, 28*scale);
  headG.addColorStop(0, '#e8cba0');
  headG.addColorStop(1, '#9a7050');
  ctx.beginPath();
  ctx.ellipse(0, -150*scale, 20*scale, 26*scale, 0, 0, Math.PI*2);
  ctx.fillStyle = headG;
  ctx.fill();

  // Neck
  ctx.beginPath();
  ctx.rect(-8*scale, -125*scale, 16*scale, 15*scale);
  ctx.fillStyle = '#b89070';
  ctx.fill();

  // Smart fiber glow effect (animated)
  const t = Date.now() * 0.001;
  const glowIntensity = (Math.sin(t * 2) * 0.3 + 0.7);

  if (mode === 'cooling') {
    ctx.shadowColor = 'rgba(0,180,255,' + glowIntensity + ')';
    ctx.shadowBlur = 20;
    ctx.strokeStyle = `rgba(0,200,255,${glowIntensity * 0.4})`;
    ctx.lineWidth = 1;
    for(let i = -70; i <= 70; i += 22) {
      ctx.beginPath();
      ctx.moveTo(i*scale, -20*scale);
      ctx.lineTo(i*scale + (i*0.6)*scale, 200*scale);
      ctx.stroke();
    }
    ctx.shadowBlur = 0;
  } else if (mode === 'heating') {
    ctx.shadowColor = 'rgba(255,100,0,' + glowIntensity + ')';
    ctx.shadowBlur = 15;
  }

  ctx.restore();
}

// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
// MAIN LOOP
// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
let thermalMode = 'cooling';

function mainLoop() {
  animFrame = requestAnimationFrame(mainLoop);

  // Resize check
  const rect = document.querySelector('.center-area').getBoundingClientRect();
  if (mCanvas.width !== rect.width || mCanvas.height !== rect.height) {
    mCanvas.width = rect.width; mCanvas.height = rect.height;
  }

  if (isRotating) mannequinAngle += 0.015;

  drawBg();
  drawParticles();

  // Clear mannequin
  mCtx.clearRect(0, 0, mCanvas.width, mCanvas.height);
  draw3DMannequin(mCtx, mCanvas.width, mCanvas.height, mannequinAngle, currentFabricColor, thermalMode);
}

// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
// UI FUNCTIONS
// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
function notify(msg) {
  const n = document.getElementById('notif');
  n.textContent = msg;
  n.style.display = 'block';
  clearTimeout(n._t);
  n._t = setTimeout(() => n.style.display = 'none', 2500);
}

function updateTemp(val) {
  document.getElementById('temp-val').innerHTML = val + '<sup>¬∞C</sup>';
  const temp = parseInt(val);
  const statusMode = document.getElementById('status-mode');
  const fiberMode  = document.getElementById('fiber-mode');

  if (temp > 30) {
    statusMode.textContent = 'COOLING ACTIVE';
    statusMode.style.color = 'var(--cyan)';
    fiberMode.textContent  = 'VENTILATING';
    thermalMode = 'cooling';
  } else if (temp < 20) {
    statusMode.textContent = 'HEATING ACTIVE';
    statusMode.style.color = '#ff6600';
    fiberMode.textContent  = 'INSULATING';
    thermalMode = 'heating';
  } else {
    statusMode.textContent = 'BALANCED';
    statusMode.style.color = 'var(--green)';
    fiberMode.textContent  = 'ADAPTIVE';
    thermalMode = 'neutral';
  }
}

function selectFabric(el, name, color, tag) {
  document.querySelectorAll('.fabric-item').forEach(i => i.classList.remove('active'));
  el.classList.add('active');

  // Parse hex color
  const r = parseInt(color.slice(1,3),16);
  const g = parseInt(color.slice(3,5),16);
  const b = parseInt(color.slice(5,7),16);
  targetFabricColor = {r, g, b};

  document.getElementById('eco-mat').textContent = name;
  notify('‚óà ' + name.toUpperCase() + ' SELECTED ¬∑ ' + tag);
}

function toggleRotate() {
  isRotating = !isRotating;
  notify(isRotating ? '‚ü≥ ROTATION ENABLED' : '‚ü≥ ROTATION PAUSED');
}

// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
// AR MODE
// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
let arAnim;

function openAR() {
  const overlay = document.getElementById('ar-overlay');
  overlay.classList.add('active');
  notify('‚óà AR MODE INITIALIZING...');

  // WebXR check (real devices)
  if (navigator.xr) {
    navigator.xr.isSessionSupported('immersive-ar').then(supported => {
      if (supported) {
        startWebXRAR();
      } else {
        startSimulatedAR();
      }
    }).catch(() => startSimulatedAR());
  } else {
    startSimulatedAR();
  }
}

function startSimulatedAR() {
  notify('‚óà AR SURFACE DETECTION ACTIVE');
  const arCanvas = document.getElementById('ar-3d-canvas');
  const ctx = arCanvas.getContext('2d');

  function resize() {
    arCanvas.width = window.innerWidth;
    arCanvas.height = window.innerHeight;
  }
  resize();

  let arAngle = 0;
  function arLoop() {
    arAnim = requestAnimationFrame(arLoop);
    ctx.clearRect(0,0,arCanvas.width,arCanvas.height);

    const cx = arCanvas.width * 0.6;
    const cy = arCanvas.height * 0.5;

    arAngle += 0.02;

    // AR placement indicator
    ctx.save();
    ctx.translate(cx, cy);

    // Ground plane indicator
    ctx.beginPath();
    ctx.ellipse(0, 150, 80, 25, 0, 0, Math.PI*2);
    ctx.strokeStyle = 'rgba(0,255,231,0.5)';
    ctx.lineWidth = 1;
    ctx.stroke();
    ctx.fillStyle = 'rgba(0,255,231,0.05)';
    ctx.fill();

    // AR axis lines
    ctx.strokeStyle = 'rgba(0,255,231,0.3)';
    ctx.lineWidth = 1;
    for(let i = -80; i <= 80; i += 20) {
      ctx.beginPath(); ctx.moveTo(i, 150); ctx.lineTo(i + 15, 300); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(-80, 150 + (i+80)*0.8); ctx.lineTo(80, 150 + (i+80)*0.8); ctx.stroke();
    }

    // Draw floating mannequin in AR
    draw3DMannequin(ctx, 0, 0, arAngle, currentFabricColor, thermalMode);

    // AR data tags
    [[-120, -80, 'NANO-FIBER'], [120, -40, 'TEMP: ' + document.getElementById('temp-slider').value + '¬∞C'], [100, 80, '98% OPTIMAL']].forEach(([dx, dy, label]) => {
      ctx.beginPath();
      ctx.moveTo(0, 0);
      ctx.lineTo(dx, dy);
      ctx.strokeStyle = 'rgba(0,255,231,0.3)';
      ctx.lineWidth = 0.5;
      ctx.stroke();
      ctx.fillStyle = 'rgba(0,0,0,0.6)';
      ctx.fillRect(dx - 40, dy - 12, 80, 22);
      ctx.strokeStyle = 'rgba(0,255,231,0.5)';
      ctx.lineWidth = 1;
      ctx.strokeRect(dx - 40, dy - 12, 80, 22);
      ctx.fillStyle = 'var(--cyan, #00ffe7)';
      ctx.font = '8px Space Mono, monospace';
      ctx.textAlign = 'center';
      ctx.fillText(label, dx, dy + 3);
    });

    ctx.restore();
  }
  arLoop();
}

function startWebXRAR() {
  notify('‚óà WEBXR AR SESSION STARTING...');
  const gl = document.getElementById('ar-3d-canvas').getContext('webgl', {xrCompatible: true});
  navigator.xr.requestSession('immersive-ar', {
    requiredFeatures: ['hit-test'],
    optionalFeatures: ['dom-overlay'],
    domOverlay: { root: document.getElementById('ar-overlay') }
  }).then(session => {
    notify('‚óà WEBXR AR ACTIVE ‚Äî REAL DEVICE');
    session.addEventListener('end', closeAR);
    // Minimal WebXR setup
    const refSpace = session.requestReferenceSpace('local');
    function onFrame(t, frame) {
      session.requestAnimationFrame(onFrame);
    }
    session.requestAnimationFrame(onFrame);
  }).catch(() => startSimulatedAR());
}

function closeAR() {
  document.getElementById('ar-overlay').classList.remove('active');
  if (arAnim) { cancelAnimationFrame(arAnim); arAnim = null; }
  notify('‚óà AR MODE CLOSED');
}

// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
// VR MODE
// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
let vrAnim, vrSession = null;

function openVR() {
  const demo = document.getElementById('vr-demo');
  demo.classList.add('active');
  notify('‚óà VR SHOWROOM INITIALIZING...');

  if (navigator.xr) {
    navigator.xr.isSessionSupported('immersive-vr').then(supported => {
      if (supported) startWebXRVR();
      else startSimulatedVR();
    }).catch(() => startSimulatedVR());
  } else {
    startSimulatedVR();
  }
}

function startSimulatedVR() {
  notify('‚óà VR LUXURY SHOWROOM ACTIVE');
  const canvas = document.getElementById('vr-canvas');
  const ctx = canvas.getContext('2d');

  function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
  resize();

  let cameraY = 0, lightAngle = 0;

  function vrLoop() {
    vrAnim = requestAnimationFrame(vrLoop);
    const W = canvas.width, H = canvas.height;
    lightAngle += 0.01;
    if (vrAutoRotate) vrAngle += 0.008;

    // VR background - split screen effect
    ctx.fillStyle = '#000008';
    ctx.fillRect(0,0,W,H);

    // Stereo split line
    ctx.strokeStyle = 'rgba(201,168,76,0.3)';
    ctx.lineWidth = 2;
    ctx.beginPath(); ctx.moveTo(W/2,0); ctx.lineTo(W/2,H); ctx.stroke();

    // Draw for both eyes
    [W*0.25, W*0.75].forEach((eyeX, eyeIdx) => {
      ctx.save();
      ctx.beginPath();
      ctx.rect(eyeIdx === 0 ? 0 : W/2, 0, W/2, H);
      ctx.clip();

      // Showroom floor
      const floorG = ctx.createLinearGradient(eyeX-300, H*0.5, eyeX+300, H);
      floorG.addColorStop(0, '#0a0f20');
      floorG.addColorStop(1, '#050810');
      ctx.fillStyle = floorG;
      ctx.beginPath();
      ctx.moveTo(eyeX-500, H);
      ctx.lineTo(eyeX-200, H*0.55);
      ctx.lineTo(eyeX+200, H*0.55);
      ctx.lineTo(eyeX+500, H);
      ctx.fill();

      // Floor grid
      ctx.strokeStyle = 'rgba(201,168,76,0.15)';
      ctx.lineWidth = 0.5;
      for(let i = -5; i <= 5; i++) {
        ctx.beginPath();
        ctx.moveTo(eyeX + i*80, H*0.55);
        ctx.lineTo(eyeX + i*80*3, H);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(eyeX-500, H*0.55 + (H-H*0.55)*(i+5)/10);
        ctx.lineTo(eyeX+500, H*0.55 + (H-H*0.55)*(i+5)/10);
        ctx.stroke();
      }

      // Ambient light rays
      const lightX = eyeX + Math.cos(lightAngle) * 200;
      const lightR = ctx.createRadialGradient(lightX, 0, 0, lightX, 0, 400);
      lightR.addColorStop(0, `rgba(${Math.round(currentFabricColor.r*0.3+100)},${Math.round(currentFabricColor.g*0.2+60)},${Math.round(currentFabricColor.b*0.1+40)},0.15)`);
      lightR.addColorStop(1, 'transparent');
      ctx.fillStyle = lightR;
      ctx.fillRect(eyeX-400, 0, 800, H);

      // Center mannequin (VR scale)
      ctx.translate(eyeX, H*0.5);
      draw3DMannequin(ctx, 0, 0, vrAngle + (eyeIdx === 0 ? -0.03 : 0.03), currentFabricColor, thermalMode);

      // Showroom UI elements
      ctx.fillStyle = 'rgba(0,0,0,0.6)';
      ctx.fillRect(-W*0.22, -H*0.45, W*0.44, 40);
      ctx.strokeStyle = 'rgba(201,168,76,0.5)';
      ctx.lineWidth = 1;
      ctx.strokeRect(-W*0.22, -H*0.45, W*0.44, 40);
      ctx.fillStyle = '#c9a84c';
      ctx.font = 'bold 12px Orbitron, monospace';
      ctx.textAlign = 'center';
      ctx.fillText('‚óà  VR LUXURY SHOWROOM  ‚óà', 0, -H*0.45 + 26);

      ctx.restore();
    });

    // Lens effect (barrel distortion sim via vignette)
    const vign = ctx.createRadialGradient(W/2, H/2, H*0.3, W/2, H/2, H*0.7);
    vign.addColorStop(0, 'transparent');
    vign.addColorStop(1, 'rgba(0,0,0,0.5)');
    ctx.fillStyle = vign;
    ctx.fillRect(0,0,W,H);
  }
  vrLoop();
}

function startWebXRVR() {
  notify('‚óà WEBXR VR SESSION STARTING...');
  const canvas = document.getElementById('vr-canvas');
  const gl = canvas.getContext('webgl', {xrCompatible: true});

  navigator.xr.requestSession('immersive-vr', {
    optionalFeatures: ['local-floor', 'bounded-floor']
  }).then(session => {
    vrSession = session;
    notify('‚óà WEBXR VR ACTIVE ‚Äî REAL DEVICE');
    session.addEventListener('end', () => { vrSession = null; closeVR(); });
    session.requestAnimationFrame(function onXRFrame(t, frame) {
      session.requestAnimationFrame(onXRFrame);
    });
  }).catch(() => startSimulatedVR());
}

function toggleVRRotate() {
  vrAutoRotate = !vrAutoRotate;
  notify(vrAutoRotate ? '‚ü≥ AUTO ROTATE ON' : '‚ü≥ AUTO ROTATE OFF');
}

function closeVR() {
  if (vrSession) { vrSession.end(); vrSession = null; }
  document.getElementById('vr-demo').classList.remove('active');
  if (vrAnim) { cancelAnimationFrame(vrAnim); vrAnim = null; }
  notify('‚óà VR MODE CLOSED');
}

// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
// START
// ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
window.addEventListener('load', () => {
  resizeM();
  mainLoop();
  // Initial notification
  setTimeout(() => notify('‚óà VASTRAVERSE XR SYSTEM READY'), 500);
});

window.addEventListener('resize', resizeM);
</script>
</body>
</html>
